set sql_safe_updates=0;
create database ECommerce;
use ECommerce;

CREATE TABLE customers (
    customerID INT PRIMARY KEY AUTO_INCREMENT,
    customerName VARCHAR(50) NOT NULL,
    customerEmail VARCHAR(100) UNIQUE NOT NULL,
    customerPhoneNo VARCHAR(20) NOT NULL,
    customerAddress VARCHAR(100) NOT NULL,
    customerAccountCreatedAt DATETIME NOT NULL
);

insert into customers(customerName,customerEmail,customerPhoneNo,customerAddress,customerAccountCreatedAt)
value
("Sudha Murthy","sudhaMurthy@example.com","7088766446","Infosys Street",now());

CREATE TABLE products (
    productID INT PRIMARY KEY AUTO_INCREMENT,
    productName VARCHAR(50) NOT NULL,
    productPrice DECIMAL(10 , 2 ) NOT NULL,
    productStockQuantity INT NOT NULL
);

insert into products(productName,productPrice,productStockQuantity)
value
("Iphone16",4000.35,1);

CREATE TABLE categories (
    categoryID INT PRIMARY KEY AUTO_INCREMENT,
    categoryName VARCHAR(50) NOT NULL
);


insert into categories(categoryName)
value
("Electronics");

CREATE TABLE orders (
    orderID INT PRIMARY KEY AUTO_INCREMENT,
    customerID INT,
    orderDate DATETIME NOT NULL,
    orderStatus ENUM('Pending', 'Delivered', 'Placed') NOT NULL,
    totalAmount DECIMAL(10 , 2 ) NOT NULL,
    FOREIGN KEY (customerID)
        REFERENCES customers (customerID)
);

insert into orders(customerID,orderDate,orderStatus,totalAmount)
value
(3,now(),"Delivered",4000.35);

CREATE TABLE orderItems (
    orderItemsID INT PRIMARY KEY AUTO_INCREMENT,
    orderID INT,
    productID INT,
    orderItemQuantity INT NOT NULL,
    unitPrice DECIMAL(10 , 2 ),
    FOREIGN KEY (orderID)
        REFERENCES orders (orderID),
    FOREIGN KEY (productID)
        REFERENCES products (productID)
);

alter table orderItems
add column totalAmount decimal(10,2);

UPDATE orderItems 
SET 
    totalAmount = unitPrice * orderItemQuantity
WHERE
    orderItemsID = 2;

CREATE 
    TRIGGER  totalAmountUpdate
 BEFORE UPDATE ON orderItems FOR EACH ROW 
    SET new . totalAmount = (new.unitPrice * new.orderItemQuantity);

insert into orderItems(orderID,productID,orderItemQuantity,unitPrice)
value
(3,3,2,3200.35);

CREATE TABLE productCategories (
    productID INT,
    categoryID INT,
    FOREIGN KEY (productID)
        REFERENCES products (productID),
    FOREIGN KEY (categoryID)
        REFERENCES categories (categoryID)
);

insert into productCategories(productID,categoryID)
value
(2,1);

SELECT *FROM customers;
SELECT * FROM products;
SELECT * FROM categories;
SELECT * FROM orders;
SELECT * FROM orderItems;
SELECT * FROM productCategories;
